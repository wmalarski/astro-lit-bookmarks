---
import Layout from "../layouts/Layout.astro";
import "../components/Button/Button";
import { paths } from "@utils/paths";
import { findTags } from "@server/tags";
import { TypedTagsList } from "@modules/tags/TagsList";
import { findBookmarks, findBookmarksByMastoIds } from "@server/bookmarks";
import { TypedBookmarkList } from "@modules/bookmarks/BookmarkList";

if (!Astro.locals.session) {
  return Astro.redirect(paths.login);
}

const tags = findTags(Astro);

const mastoBookmarks = await Astro.locals.mastoClient?.v1.bookmarks.list({
  limit: 10,
});

const mastoBookmarksMatched = findBookmarksByMastoIds(Astro, {
  mastoBookmarks: mastoBookmarks ?? [],
});

const bookmarks = findBookmarks(Astro, {
  to: new Date(),
});
---

<Layout title="Welcome to Astro.">
  <main>
    <alb-button>Primary</alb-button>
    <alb-button variant="secondary">Secondary</alb-button>
    <alb-button disabled>AAA</alb-button>
    <alb-button size="small">Small</alb-button>
    <alb-button size="medium">Medium</alb-button>
    <alb-button size="large">Large</alb-button>

    <a href={paths.loginMastodon}>Sign in with Mastodon</a>
    <a href={paths.logout}>Sign out</a>

    <TypedTagsList client:load tags={tags} />
    <TypedBookmarkList
      client:load
      bookmarks={bookmarks}
      mastoBookmarks={mastoBookmarksMatched}
      tags={tags}
    />
  </main>
</Layout>
